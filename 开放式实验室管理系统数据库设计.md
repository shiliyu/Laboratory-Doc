# 开放式实验室管理系统数据库设计

## 1. 权限控制模块

整个实验室管理后台的核心，用户在登录时判断角色和权限，来显示相应的菜单，并且对用户访问的url做拦截。

### 1.1 管理员表（admin）

说明：只有拥有管理员账号的用户才可进入实验室管理后台，和可以任意访问的前台是不同的账号，学生和老师可以有一个前台预约实验的账号，这个账号是无法登录后台的，需另一套管理账号。管理员用户包含实验室管理员，系主任，院实验室中心主任，校实验室中心主任，系统超级管理员。

| 序号 | 字段名称 |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |                             说明                             |
| :--: | :------: | :---------: | :----------: | :--------: | :----------------------------------------------------------: |
|  1   |    id    |   char(9)   |      N       |     Y      |                  主键，教师职工号，用作登录                  |
|  2   |   name   | varchar(15) |      N       |     N      |                管理员名，用作登录系统后的显示                |
|  3   | password | varchar(25) |      N       |     N      |                      登录密码，用作登录                      |
|  4   |   tel    | varchar(11) |      Y       |     N      |                           电话号码                           |
|  5   |  email   | varchar(25) |      Y       |     N      |                             邮箱                             |
|  6   | identity | varchar(1)  |      N       |     N      | 用户身份，0代表系统超级用户，3代表实验室管理员，4代表系主任，5代表院实验室中心主任，6校实验室中心主任 |
|  7   |  status  | varchar(1)  |      N       |     N      |             账号状态，Null 为激活，1 为正常使用              |

### 1.2 角色表（role）

说明：管理员在实验室管理后台的角色，角色对应管理功能。

| 序号 |    字段     |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |               说明               |
| :--: | :---------: | :---------: | :----------: | :--------: | :------------------------------: |
|  1   |     id      |     int     |      N       |     Y      | 主键，自增长，角色序号，冗余字段 |
|  2   |    name     | varchar(15) |      N       |     Y      |            系统角色名            |
|  3   | description | varchar(25) |      N       |     N      |           系统角色描述           |

### 1.3 权限表（privilege）

说明：角色包含权限，权限分级，一级权限中是二级权限，有一级权限才可以有二级权限，以此类推。权限数据在系统初始化时直接手动录入表中，不做额外的增删改查功能。

| 序号 |   字段   |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |                             说明                             |
| :--: | :------: | :---------: | :----------: | :--------: | :----------------------------------------------------------: |
|  1   |    id    |     int     |      N       |     Y      |                        主键，权限序号                        |
|  2   |   name   | varchar(10) |      N       |     Y      |                          系统权限名                          |
|  3   |   url    | varchar(25) |      N       |     N      |                        访问权限的url                         |
|  4   |   icon   | varchar(25) |      Y       |     N      |                       权限菜单前的图标                       |
|  5   | parentId |     int     |      Y       |     N      | 父级权限序号，若为空，则代表是一级权限，不为空是二级及以下权限 |

### 1.4 管理员角色表（admin_role）

说明：管理员和角色是多对多的关系，用第三张表来维护关系，表的主键为联合主键（管理员序号，角色序号）。

| 序号 |  字段   | 数据类型 | 允许为空 Y/N | 唯一性 Y/N |           说明           |
| :--: | :-----: | :------: | :----------: | :--------: | :----------------------: |
|  1   | adminId | char(9)  |      N       |     N      | 管理员序号，联合主键之一 |
|  2   | roleId  |   int    |      N       |     N      |  角色序号，联合主键之一  |

### 1.5 角色权限表（role_privilege）

说明：角色和权限是多对多的关系，用第三张表来维护关系，表的主键为联合主键（角色序号，权限序号）。

| 序号 |   字段    | 数据类型 | 允许为空 Y/N | 唯一性 Y/N |          说明          |
| :--: | :-------: | :------: | :----------: | :--------: | :--------------------: |
|  1   |  roleId   |   int    |      N       |     N      | 角色序号，联合主键之一 |
|  2   | privilege |   int    |      N       |     N      | 权限序号，联合主键之一 |



## 2. 实验室模块

### 2.1 实验室信息表（lab_info）

说明：实验室相关情况的介绍，创建人不设置成外键，直接使用管理员的 id 加上 name来填写该字段。

| 序号 |    字段    |   数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :--------: | :----------: | :----------: | :--------: | :------------------------: |
|  1   |     id     |     int      |      N       |     Y      |  主键，自增长，实验室序号  |
|  2   |   title    | varchar(32)  |      N       |     N      |         实验室名称         |
|  3   | introduce  | varchar(255) |      N       |     N      |         实验室介绍         |
|  4   |  location  | varchar(25)  |      N       |     N      |         实验室位置         |
|  5   |  creator   | varchar(25)  |      N       |     N      |           创建人           |
|  6   | createTime | varchar(19)  |      N       |     N      | 创建时间，默认为当前的时间 |
|  7   |   number   |     int      |      N       |     N      |      可容纳的实验人数      |

### 2.2 实验室公告表（lab_announce）

说明：实验室的公告信息，创建人不设置成外键，直接使用管理员的 id 加上 name来填写该字段，公告信息不设置具体的实验室外键，只是由实验室管理员发出的实验室相关的公告信息。

| 序号 |    字段    |   数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :--------: | :----------: | :----------: | :--------: | :------------------------: |
|  1   |     id     |     int      |      N       |     Y      |   主键，自增长，公告序号   |
|  2   |  content   | varchar(255) |      N       |     N      |          公告内容          |
|  3   |  creator   | varchar(25)  |      N       |     N      |           创建人           |
|  4   | createTime | varchar(19)  |      N       |     N      | 创建时间，默认为当前的时间 |

### 2.3 实验室布局图表（lab_layout）

说明：实验室内布局情况，直接将图片存入到数据库中，而不是保存图片的路径，创建人不设置成外键，直接使用管理员的 id 加上 name 来填写该字段。

| 序号 |    字段    |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |             说明             |
| :--: | :--------: | :---------: | :----------: | :--------: | :--------------------------: |
|  1   |     id     |     int     |      N       |     Y      | 主键，自增长，实验室布局序号 |
|  2   |   title    | varchar(32) |      N       |     N      |          布局的标题          |
|  3   |    img     |    blob     |      N       |     N      |          布局的图片          |
|  4   |  creator   | varchar(25) |      N       |     N      |            创建人            |
|  5   | createTime | varchar(19) |      N       |     N      |  创建时间，默认为当前的时间  |

### 2.4 实验室设备表（lab_equipment）

说明：实验室中的设备，和具体的实验室相关联，所以要设置具体实验室的外键。

| 序号 |    字段     |   数据类型   | 允许为空 Y/N | 唯一性 Y/N |             说明             |
| :--: | :---------: | :----------: | :----------: | :--------: | :--------------------------: |
|  1   |     id      |     int      |      N       |     Y      | 主键，自增长，实验室设备序号 |
|  2   |    name     | varchar(32)  |      N       |     N      |           设备名称           |
|  3   |   status    |  varchar(5)  |      N       |     N      |           设备状态           |
|  4   | description | varchar(255) |      N       |     N      |           设备介绍           |
|  5   |     img     |     blob     |      N       |     N      |           设备图片           |
|  6   |    labId    |     int      |      N       |     N      |    外键，设备所在的实验室    |
|  7   |   inTime    | varchar(19)  |      N       |     N      |         设备录入时间         |

## 3. 人员模块

### 3.1 普通用户表（user）

说明：管理员表在前面的权限控制模块已经说了，普通用户表和管理员表分开是为了便于设置人员信息管理的权限以及对于实验预约的考虑（班级）。普通用户包括老师和学生，学生和老师预约实验时也是需要登录的，所以也要有密码。班级字段中包含有专业的信息，如计科11502班，所以不需要再额外设置专业的外键。

| 序号 |   字段   |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |              说明              |
| :--: | :------: | :---------: | :----------: | :--------: | :----------------------------: |
|  1   |    id    |   char(9)   |      N       |     Y      |  主键，学生学号或者教师职工号  |
|  2   |   name   | varchar(15) |      N       |     N      |       学生或者老师的姓名       |
|  3   | password | varchar(25) |      N       |     N      |              密码              |
|  4   | identity |   char(1)   |      N       |     N      | 用户身份，1代表学生，2代表老师 |
|  5   | banjiId  |     int     |      N       |     N      |         外键，班级序号         |

### 3.2 班级表（banji） 

说明：班级表中设计冗余记录，因为老师可能会带有多个班级的实验课，老师身份的 classId 为 Null。

| 序号 | 字段 |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |           说明           |
| :--: | :--: | :---------: | :----------: | :--------: | :----------------------: |
|  1   |  id  |     int     |      N       |     Y      | 主键，班级序号，冗余字段 |
|  2   | name | varchar(10) |      N       |     N      |          班级名          |

## 4. 资源模块

### 4.1 教学资源表（res_teach）

说明：教学的相关资源，如实验指导手册，实验任务书等，上传到服务器专门的文件夹中。

| 序号 |    字段     |   数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :---------: | :----------: | :----------: | :--------: | :------------------------: |
|  1   |     id      |     int      |      N       |     Y      | 主键，自增长，教学资源序号 |
|  2   |    name     | varchar(25)  |      N       |     Y      |          资源名称          |
|  3   | description | varchar(255) |      N       |     N      |          资源介绍          |
|  4   |    path     | varchar(40)  |      N       |     Y      |          存放路径          |

### 4.2 优秀学生作品表（res_works）

说明：学生作品和教学资源字段相同，但为了方便使用，分为了两个表。

| 序号 |    字段     |   数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :---------: | :----------: | :----------: | :--------: | :------------------------: |
|  1   |     id      |     int      |      N       |     Y      | 主键，自增长，学生作品序号 |
|  2   |    name     | varchar(25)  |      N       |     Y      |          作品名称          |
|  3   | description | varchar(255) |      N       |     N      |          作品介绍          |
|  4   |    path     | varchar(40)  |      N       |     Y      |          存放路径          |

## 5. 论坛模块

### 5.1 论坛版块（bbs_section）

说明：帖子按版块进行分类，由管理员设置帖子版块。创建人不设置成外键，直接使用管理员的 id 加上 name 来填写该字段。

| 序号 |    字段     |   数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :---------: | :----------: | :----------: | :--------: | :------------------------: |
|  1   |     id      |     int      |      N       |     Y      |   主键，自增长，版块序号   |
|  2   |    name     | varchar(15)  |      N       |     Y      |          版块名称          |
|  3   | description | varchar(255) |      N       |     Y      |         版块的描述         |
|  4   |   creator   |   char(25)   |      N       |     N      |           创建人           |
|  4   |  creatTime  | varchar(19)  |      N       |     N      | 创建时间，默认为当前的时间 |

### 5.2 论坛帖子（bbs_post）

说明：版块下面的帖子，普通用户创建帖子。帖子所属的用户，帖子所在的版块都设置外键。

| 序号 |   字段    |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :-------: | :---------: | :----------: | :--------: | :------------------------: |
|  1   |    id     |     int     |      N       |     Y      |   主键，自增长，帖子序号   |
|  2   |   title   | varchar(25) |      N       |     Y      |          帖子标题          |
|  3   |  content  |    text     |      N       |     Y      |          帖子内容          |
|  4   |  userId   |   char(9)   |      N       |     N      |     外键，帖子的创建人     |
|  5   | creatTime | varchar(19) |      N       |     N      | 创建时间，默认为当前的时间 |
|  6   | sectionId |     int     |      N       |     N      |    外键，帖子所在的版块    |

### 5.3 帖子评论（bbs_comment）

说明：帖子下面的评论，评论人为普通用户表的外键。评论所属的帖子设置为外键。

| 序号 |   字段    |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :-------: | :---------: | :----------: | :--------: | :------------------------: |
|  1   |    id     |     int     |      N       |     Y      |   主键，自增长，帖子序号   |
|  2   |  content  |    text     |      N       |     N      |          评论内容          |
|  3   |  userId   |   char(9)   |      N       |     N      |        外键，评论人        |
|  4   | creatTime | varchar(19) |      N       |     N      | 评论时间，默认为当前的时间 |
|  5   |  postId   |     int     |      N       |     N      |    外键，评论所属的帖子    |

## 6. 预约模块

### 6.1 实验课程（course）

| 序号 | 字段 |  数据类型   | 允许为空 Y/N | 唯一性 Y/N |            说明            |
| :--: | :--: | :---------: | :----------: | :--------: | :------------------------: |
|  1   |  id  |     int     |      N       |     Y      | 主键，自增长，实验课程序号 |
|  2   | name | varchar(25) |      N       |     N      |        实验课程名称        |

### 6.2 教师预约（book_teacher）
| 序号 |   字段    | 数据类型 | 允许为空 Y/N | 唯一性 Y/N |                          说明                          |
| :--: | :-------: | :------: | :----------: | :--------: | :----------------------------------------------------: |
|  1   |    id     |   int    |      N       |     Y      |               主键，自增长，预约记录序号               |
|  2   |   date    |   date   |      N       |     N      |                      实验预约日期                      |
|  3   |  lesson   | char(1)  |      N       |     N      |                第几大节，1 代表第一大节                |
|  4   |  banjiId  |   int    |      N       |     N      |                     外键，班级序号                     |
|  5   | courseId  |   int    |      N       |     N      |                   外键，实验课程序号                   |
|  6   | teacherId | char(9)  |      N       |     N      |                 外键，预约人，教师编号                 |
|  7   |  status   | char(1)  |      N       |     N      | 实验预约状态，0 为待审核，1 为审核通过，2 为审核未通过 |

### 6.3 学生预约记录（book_student）

| 序号 |   字段    | 数据类型 | 允许为空 Y/N | 唯一性 Y/N |                          说明                          |
| :--: | :-------: | :------: | :----------: | :--------: | :----------------------------------------------------: |
|  1   |    id     |   int    |      N       |     Y      |               主键，自增长，预约记录序号               |
|  2   |   date    |   date   |      N       |     N      |                      预约实验日期                      |
|  3   |  lesson   | char(1)  |      N       |     N      |             第几大节，数字 1 代表第一大节              |
|  4   | courseId  |   int    |      N       |     N      |                     外键，课程序号                     |
|  5   | studentId | char(9)  |      N       |     N      |                 外键，预约人，学生学号                 |
|  6   |  status   | char(1)  |      N       |     N      | 实验预约状态，0 为待审核，1 为审核通过，2 为审核未通过 |


**特殊说明：**

1. 为什么有些信息表中不直接设置外键，而是管理员的 id + name 来充当伪外键？

首先对一些信息设置创建人字段，只是记录一下这个信息是谁的创建的，没有其他的作用。并且在使用 HIbernate 时采用的是 xml 文件配置实体类之间各种关系（一对多，多对一，多对多）。设置外键就要在双方的实体类映射文件中配置一对多和多对一的关系，管理员管理的信息还是不少的，如果直接设置外键，这样一来就在映射文件中需要写大量的配置，而我们并不期望通过外键知道更多的信息，所以直接设置外键会加大工作量，但实际作用也不大。又因为 id 是管理员表的主键，name是可以重复的，所以为了伪外键的唯一性采用管理员的 id + name 的方式充当一些信息的伪外键。

但对于在论坛种发帖和评论，用户采用直接外键，这里不能省，因为若没有这个外键，就没办法查询某个用户的帖子，因为用户名是有可能重复的，要通过用户编号来查询。

2. 为什么时间类型不用 datetime 类型，而用 String 类型？

在操作过程中，发现插入数据库后，秒后面又会增加几位微秒，这是没有必要的，时间只要求到年月日时分秒，格式为 yyyy-MM-dd HH:mm:ss，共19位，空格也算，这也即是插入到数据库的字符串格式。使用有格式的字符串作为时间，在需要时是可以转成 Java 的 Date 类型的，完全可以对时间操作的。